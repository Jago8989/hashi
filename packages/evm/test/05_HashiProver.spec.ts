import { SignerWithAddress } from "@nomiclabs/hardhat-ethers/dist/src/signer-with-address"
import { expect } from "chai"
import { Contract } from "ethers"
import { ethers } from "hardhat"

const SOURCE_CHAIN_ID = 1
const BLOCK_NUMBER = 20793508
const BLOCK_HEADER_HASH = "0xafd0481857f5745a4511c51695d753c56380f8a7406ae63dad368e4abdb3ec47"
const VALUE = "0x875e336081790c4c"

const ACCOUNT_PROOF = [
  "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",
  "0xf90ec7f90211a0c7f9548de2413b06c51826457d18686177d6b50cfe9c57052d5e2745ea67405fa037c538f94ae962a12ec446e99913c4a2f84f1262b6187b33e7223842c32cb2eba027252f104dbb368c148808bc165f19872ffee7923996f4b16c0638e3614dd7e7a054e4c38140beb9e6797a2fb319d8547cfa66fa1e2cb6d82127680268385aa672a07338ba4f0182c36261d92001142d58972ef60fa78bf7c619142dbc6ff600200da0a448274d9713da8237b955d1a18c1ada8ea94cfa94a6b4db2342d1842055b189a05e120865c2d8ec5f247e9d8910d7de99db8ff0241edba8740e80e36792aba2c5a012e7432e7545f98874ead265b48ac00d8e2110423be874204e27a29c7be49be6a020ea554b06c3263db4494a8b3dfe7a0bfb4c08033e67a60bd9f6cbc34d251376a0b096aac4ebdbe28c685f7394c6688e95a96e95fa367fb1fbe5f51996bcecaca7a062efd61342b2456537cbf539f25d524237be19d927a2023eed05a8cdd87eb68da09eb19a5e1d1b22618a8fef9049b62fbff55cc92e6b84a56b0d826ba751b4a291a0c1257750d37ae856d9f36832ba3133c3da159f8c96633036852bcc1d67917363a0730e6746c74c0aaa9818e2346205303e1580773e8794dbe60db756cc69d5ccb2a01aea932f111a3426ea32cdcaebb968e9faeb811b27d2d6ccbeb8f13cf3937f8ba04ad0f5122c1797f92f85cb474e4c6fc318e00ebfbf1ed705e224fe8c48c211b080f90211a07168607c5590b0a93f3b5ad40cec52042f51918229dd8e19595058cd069762a8a0d4e8dd9feab21cb31fa0a557f5e131c643bdef986d7ad5d02fe45ce7f5889792a0e364b5776f8a3624fb0000293093cd8321b120820153e97f36890395179ac4d6a0376ac4f7253988b233faaff0919df0045258800c38d2e83fbacc1eaec45e336aa0dcc6c7173e056fa08fd1967a9dfaded1d3133dd96b876f9afa901fa45e07bfd9a01fb35c15a038bbda6afd540cf3396a9c6ebca35479ecd794e38ca57aa962b6aba0d41ffbd124db9534c357ad8908d3b324170395c381980608ac053c5fd72c4130a0ebfacd5239d919283d3082ba24d8a7e601d2ef005530a26cd533243ba1cd100aa0e5d57e7ab231d26840392f500d6feff0ecd423de4f7692277ba89ccb83b8c5fca086466a5523829c87d540bb08bd632fb8eb3d7549884e00c84eb6e8ff0d5965b0a06b196898c2874c5756ba4e388acc41a86b6dc5f5114f96341ddbdde7a1c7a784a061a300fe3f07508c39b9f23c503f89e77c389be2389305da52cddc87aceab4aca055fc141795501ea6ede95f7e8383776f88474af4183092abce713f30ffdf5058a00e8a492f76c475f258d612894073af63b762dfb0ce19f58cee9ab5dbcd729da0a06572d551070866c6eb9fd99320fc27017a4d5a10989e00191de260cc59b6ea86a0ab842580f5891239a9add6f0cb6e8aaf1c7081b08f29752c8ef56c8c218cf00c80f90211a069055abb2693d9d442e7c992b263238fb8fb2c8cec4af8ca2a3201838f89b7a7a04fd2945e89d5dc6a0f43e0930cdbf5d70abf9c90127a8839b8b07240d912a4d0a0f842f3370180cc30bb6521c12fd42ae2d88bee77e73254a6f239f88469c09c55a05537d33d7d06cc4580f3e7e9d7654ef044da71ace71bdf5baf29966561e45befa066cbbd1fc101198ea2e2690dc8d980c72d33a2f6b820d387adb398a116025c18a0697c9530067e3351e87a7c6e6fbbc2a282febe0b63d229b0f4e292d66a1e4c6fa0f72324a07205eae63e114985fa445800a8285e75a53c3adca0466793eead1840a099cd34991d25321a827556e34d2cd347b589037f2b1bc677f940011b7a1c13d7a07863da67c7f99c4243a57456d4a05ddc066c6c8d8fcb25c8c08f01a10533e570a01197d8ef083352a2d90d88551891b3deab62bc20685978b4d99d5fa14cbfa052a07f34645f90cbf7298dc60c7048e1d352e70dd1dae6f787598b6d1080f49971e8a03272e0642f91eb4501840dcc7e9c436ed63344b11f7f049048bcb1a3a7df2ca8a08a76ffa84b3e9272cb6428d49454038859d457bb204f624599ab579dcfef12dea0e7a55031502f08d2734db4ef7390bf17f44e2b3478d70e9bef809c206f293bdfa0abdfb9de732a5cebbd5c92a5001e65db3dda1ce7253435ba5c5708680e2e7726a0b561a68db428a042a35d754a7a1a9f6ebe8836081f992d3d2de19ccec0a55e4980f90211a0bf2ec407e3de692c31ef7df972caa2a21282902d3c2c7869a0bd44868ccd6af4a0e5e4bacd58a1a934a147638918e4451d160e9ec99647ea7f8852c02e073075c2a0e694ba7072b174c6a6752c02d1ec11d7cd988412bd6c37f07d295fbb7f14756fa0d6c7c0fa4c81d699e045c2a22ba0eb61179e4496804d6c0e592b5047b2993191a0798fddb883c25774fc6d1f51b652b8ea81dd03588410b571767727762c1e4c5aa07a7db1965aa0ad10434a95220de03416e2ddd00d654b33d3dc2ed2f7b8f48d22a0be7ed44c61160c17a7b5a3ca5495bf614f6f640c75b095aa6960c872e233e158a09df22d1f287814d3cb828ecea1120d6a9055254e8164d2cfd8b98c5ae0980ba3a0a674bd1b8aaeccc467b331edcb9af81dd09131866e71d055619e57dad9b6a03ea08faed450b4c2371166de0eb1d7db6d5f1af19bd5fd4e7a0b12681026e7a1cdcba0b11e6cc0bc06f9e2dfebb7fafd410a461394ee3f50ec911c7049a390c9c27845a0d2fde948974177cfbfb25d3009d6cbddb9b4f6892df707546f2c00ba03435ecba04be0d058b041af7ce8807b0ca411360cdee3eb6f0059c906ba5600e8f0587309a0b62c7263e747cbed29cc1658606baddcfff8d9aaaf8e25a0d82bed3850e567c3a087b63a803df5cac69d9c9faf447a1289d8c1cb273faf55337d04dfb4111681e9a0ec352f8139edb0fe592c12d452b32defa9570e2f370f74a5feae7924d5785ce580f90211a0cd95d3ae92f92c6839f0f7435ee60791da5027497cec01dc1f4a199b131a608ea0fc91ae6a7c9106cfc39b0efc92870e9f4c98bb7a20ad21ea3d853f4a831efdbca03e3383dfc994780e7393654e27daf30f26f5f2e86c572360bead1a07b32d22c0a0cd6460eb11a1728f4b0ac2caea14b83a6ca0f54995d7f41a8852d1d234ba57f2a0c7edf11df5fcbc8d6bef9c4d63d71c81a02b7893c57a49c432b9177409509c75a0534bc98a6e093069585cf811762741c8594a6b42828f5ad825929ecd8bfc20e4a0d634fe101ab5770dcb54a80a2b794299b300e1adf9343d1ef26c6cdffbb7f21ca0fd2c5d9a536d366c2fcd145073b3b75672699b1ea55c70fb5075f89e427b6b4aa0b82cb047822a3f3283cbe8eb6ac88d8c71b5beaf47c8c6a3e8ae50780f6dfa8aa0e8c97b53fd657b5511173624dde4f31e239c49df5a98a57e1295029f486c94a2a09cfbcdb21e2d410f156bb467897bf73964a01e6dd5539e6330634b794de649e1a0c6e20f19fdf97cba0c8a21d57b1d33e1c283f4ad93f92fb7d67cace9bd434f90a051691b3625c0367b73aebeb6f94c3b5542bbe0f72aca52277ad31a7af8546ac5a05e104969fb1ccd2b7df5bc5f77af07c4ebfc424f506ce8dd0e164c3880e3ea2ca0034154f8f674659f19216e21203706a8314edcf9700f49249aa0894e502a3bada057616f55e2e620afe5ff22f313d5b6e34cedf4a64fc6163b3e3008bae24d35a080f90211a05c2ede3805ac777d64c232fb113ab67116c8a1f252a5bc401cf9f283e9f7a6c4a07acd632dc59a4bed389f18274a1bed7167eac5777e1a3ed16224130958872632a05eb84506a1607d7521f30a366c1891a54e0e84c22a7c48535c63f74d08fc237fa05c38dd95917629395109aff3e91a0d52a13ad9ac93215a635982dfe51a1169fca04e776df61609acc8780d262ec19ae6b63ae21509f9b913d388bd1b5f1a352ae8a05ce8d36e3e8f3fd39e83e1db3b6369120e3692ad8cfc8e622350c432150d98d1a09fd76ff18b2f067852e1601c76112b4e06755d64c48cdeea021d6efefc8cc5eaa0dac65fc9721f10396a9488adc58e5722527bfba2af0c358a985132fca8faadc3a0c35faa1e275ed56ebecc0b51a8f89e115a7320a3c9823fa9a85e7d7afbb5a6eaa0932f7e0b119160a118e3eb7ed691cac7163ff775eb6e5e163a27904a14b75ecba0c41c5e70289ab77172db9e42bf65ca3a2cca2251f22f5717886a51e5d543ea9ea05d8ef1b1d38448fdbc8a6db86647ac38a4b580950bb7bc33902d82555a8f5dcba004a3dc79b1077e6e8be9bca62507b9004ed350a1095b345222f97095cd804bc4a0f53a5c5a890da2d8fa58c0eeee5e5c8dde92a1472441a514c32f03f5b6487315a03e7cff35eb4e28eeae7b163572950b781920079ccf40206ae4387906bf6327c8a05a1ba0533fe12a4dfc22ecbb2d309d113ed8959a1968b730372a99cd07272ddc80f90171a07d337e717ecd4ce5f45c4ea8994e476ce38cf937a4f2924dc40cfa8fe5870fe9a03f98e9ce6af172ec08481a6bcffb89a264933f90ee288a82144c0eab968e42ffa0eb65ea007c07bc1604264fecd433291c165a1211a8bf8bf6492cc1194fa549408080a04a57ac1163277a820bdae649d632f917b3885a80103654d3216f9409b72525d3a0031868dec233f986dc0afa16d6abf78e22396b0fa4a757f0688380756a844be2a0d3bee690d48173444d679a7ab969cd9199b83ac3de64db3d987dc6aa2ddb06e780a0ccb10237fbb545478774d6e858eb7a1327708de6c205c7195d3a5dacd5961209a0903e3cd41d04b4693e0eae1549f7fe024eb06b98fa1c137cacc66d57a7a0e223a023f24686514302e9b0707775885ba13549bad5e8c8a5464c3d8efd4b8e953d5ea0c329d67971ead7da9f1d222990d9aa6c0f448bd161c0981ef504b1d7292b666180a015234d9ef39b97af083fb5715dd5cc2f4454a23ca3a4d72419cfde3ea918036c8080f87180a0568a3548f0c468bec66c6d91b1d72f84e44373c03c6e118d7edc6ba8fe9b4d0c80808080808080a0ec26e129a6fc11a5dcc748bd22ca4e41a0ace63cbf1cb2de018e2b9585a06fc680a043ce799f2836610d1ae648b51b90bdabc437dd7ca340c1ee8c3e2d71eab6ea268080808080f8669d2092cd7f3f78137497df02f6ccb9badda93d9782e0f230c807ba728be0b846f8440180a09d5704aa434de9751d3bfcf9e720a8eb0464ed2b467bd27af86c0415ac15fa14a0d80d4b7c890cb9d6a4893e6b52bc34b56b25335cb13716e0d1d31383e6b41505",
  "0xf90256a06f14ee388c6004c9f591c05cc94509906ebcc57e6ce9d7e65c52aa7da6f530e7a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493479495222290dd7278aa3ddd389cc1e1d165cc4bafe5a07604903f485d83bda3b1333e28dec61ff3191fef0423ffce44abe02033b323d3a09c6967c2262b8e5aaf07f422806fa22eed9bd05898a71ef3435eb27e258ed240a061cf3a1b00a7ea8e1b8e4a921dbd9af3c73e9ec8646e9884b7936b74e011e05ab901005d61447fd94d1ba8d69022f0b7891c8486f9ae204a03b3b61bbbc905e371ecd613dfbe02ad85113252082314a8e78d016af918d9afd27030b5b7e890842a2f8058103e8c1640a87cd82c733d21e13afc3ce5e133ddd7fd3180a816dc8bfeeaa516555f3bf2545536b6605c1ea8276edf7d076e9346d88e37e24372bec69daa45caa8fe68c4c5edccefefbf60abaa9abee6106cf1dd25dc4fff490c7bf4b1f47993d733a25880a8170f165ed3bb283d69644fb677d0fd763a07218f66249961719ff37e762cf33f76036277f9c2d9e3d5a2a0b6b70cbfbd548a717143e29e3ef4a0f9b17f9f37bc546d06e5d23e02b3c64e2e542f026cf1d4391ccdf19400dc6d8084013d48a48401c9c3808401476c588466edbad78f6265617665726275696c642e6f7267a00b4078ca7a27f9b2448fa3f32e04a269353f80273e6dc95153458475a84238b98800000000000000008502d39a9e8ea00a7c969c5cab15361767d22966b8c0e507572acd096d3bc87af306be3ceb52138080a077f861b303ce5dd4bd241707d60a82406df608caa18ec241e33b5d5a2de94bc2",
  1,
]
const STORAGE_PROOF = [
  "0x9d5704aa434de9751d3bfcf9e720a8eb0464ed2b467bd27af86c0415ac15fa14",
  ["0x000000000000000000000000000000000000000000000000000000000000000b"],
  [
    "0xf90bd2f90211a0c03ad780fdcff9d8db9c11fb9d1e7e4b7e72ef1e7eb869620b9f8ad84fc2fcbca0affcd853d02392931c090bac4e6daf5d7803bc755efb6f4428844504e56a0824a045b77e35264af8103e562dcf7064f204cc7d97ab329e99afce4734dcd38ebe87a06345cc57a046fe6fde4a96f9b7df705ac96f8945b2bd5fadcb617f87ab56df45a03f0d7ab38aa688d896e5380f34fc7476484c04fcef6dce8fe2fd19f022bd25a1a0f1099114fbade96971fc26d2b7a2822a55ec504b69befda54d658f99afe1e58ca093c6cb05b60356a08b2ceaea7535aa0dbe0c7caf772f9a3220c9e5f17c7592b2a0c6204dc22d4f391abd77861423f3d6cd97f9fb7c2462508c1125527b50e6ca43a0a79c861c69ea5078802d04cbe0b930db2d4bdeb979ab67729c53cf9ab4aa59d3a0784e0c317729503c1212a4fd4db192bc80efe07ffc88ded9bcfc86ac2087b103a019130bf59eede0e5aafd47c1c71fc61fe989f61b4fb948d0c85db13fd6d8dfa8a0245cb0c02898fd4305783b3e4fb036ee39ab471edf5ee8108e971cedb6e2d2a5a0693c76ef03bd97763cffd1bdefb70739c94dac6480502629c83697ead422d5f6a0333cd43acdce2a4b07662fda6fd7c8c3762a0a862df5e6ddda4bace3977c55d2a051abc316d294b1d3d741fdc30ff307fc2cbcab494e74b0c87263ffecd15e5f8da04c586b6f986d28a9553494ecae5cfd6caee098a27c79d273cbdfe7b90bca613a80f90211a09543463b5652bf35a17b7a000ecdef6a09d92c0b6a294ef292706322a643ac87a087c898c7a105f122e4c2b387cabc1b62e79e673e8360872ff8154e27e2a97030a0d8cd06b11d80236ab5377ba55d89efda25a193ca125cb4a3865dd3a853477f1ca0255ccaa30d3fff8ad7d6f958fa965264f8e018d956777ba51538d0e4c1b0d0c8a0816b5b6951cfa8b2d2bfb5b477c633431fa48f3e1712f458f8644ca3b6eef807a0dae819a79bef60b8f4426e82413b2ef4c7ab5ba30ef2e66c9bc2a8bd96de660aa0457e691dbcdeedb4e8d04b48af40029f8d7ad6d99c47696234bc21921c44f47ea00dc6631d7c767e55f3581285a12a7d1bf4aafcd95a471801c885a380b11f20b3a04d949d428a282b3a1a2b6a14e356a1eda9a768d6a50eab1f49f74426a27d3063a0ae7d76fbf7178842db7758faf0360923cd0192cd6db31dc4fd71020478496605a0659e1bd5e68ac0cb78094135200440a255ea1cf5c77575eefb38d9582e03f7e6a0bb66ef993a8e694c33d65aaa7c7920c0fea2569d48392775ce6824fc5db2ffc1a00da42a0f939cc889db93be6467b5687ea1b0e185b612fe11c8b1e0f11bbbbfc7a0c8e46c9aad59802b44569997e7deace74923242b1d0f35871ebc71f7b800d53fa02d22f23e78308978f03da3fc1d30936772d871f03ae8b89e03ee0a5ec1bd9afba0feb114b06e556ac52b7494821e3ed4af5fceed2d0e98b3629abb77b0b7d5352f80f90211a09f1c2b89b4d5b29b3a5e7e4613897363f56a7706c0c48e595129326231357264a06043940ace31b3b2d2f36f526abaeed64cf196f60f752a950a603924bb1be8d1a0a7fea554f16521774b2658a882d9ce0eca1567e34a2ed6bb6a1b8861b984d1fea0f3683ecac011ff970866f63fdbad0b563301300e7f58a00e41cef674aa896d14a06440b5f591a4cb03ea6bbb4cca6b327f8b1e5684983cc171992b43a0e7d7f65aa084570b151819d27b0a0bb8b0f2231ed3a75f082a7da2fbb121b9bf83257265d8a007f572f57dc18a840b9ae7cc983d0d27c1332634711808b57e6bb6af9ef4df38a0c2dd894af0e1c66e6f1337afbb951fc7af4a954e0951e5cabd485f1c22919992a0e214cd8efa8cda96f46b320edba3c8a02a9695ca635f14cbd56c9941c39db758a06fb5032e8727fb0cfb51e6a21c2acb2ad7f25e452001ffa495ce5cd284391531a051950f31467943085f0dbef1856469a16c86174be86b17223a2f66c3a956c897a012189d14af2ef21047ceb340372c71a9a9f2842c25621b292d1458bd876b61a5a013c85fa14ffee57ef1a31e99586ae65d31d65a033c3190cda0734e5389fe9f75a04d8c8815af221c1e6c9cfcd4f736e78266277e324fee0ab92923edd59b55b9dea069819278c8af35925eeb650c2245b03e7ce93cfd595c6f9dbc98a373f0d0918fa0761df9767bb3079f512bbf47390aab6f8ddfaf81d6f8ea6ef986d6b902e5d31580f90211a02a6e912cd7f8e31035d3fe8c65a5d3287288d3888ce9657c250bb70a9f258104a0676c3257a7c90a1c32ca4976f151bc538cc16199598c3640555eddc1b9a1c2d0a0cea107052cadf545b10283abf0e1a1ef92a8e8c56a8bf2764db3adbee2230623a07c0f9c98c9b84dfb73496a3cf6c34e1133733081cf0a0e64688d102384f721b3a03492e8538a07a6d7dd2963848db053b1c9654c41e21970d6172f6148fca2cbdfa0d83c4627c93c8b8086c3cd2f7fb09536f4ec239adb2b8ae47e428565c15df5afa0265456add4ff87a819f9d5e923371a9658b74e182d8cfb4769e4e8ff9a7cfdd6a091836c477ef0ce3b69e2e0fa6737e34b4a9092760194a3942aaa6d9a1426cfcfa0367e3c9c841827130d8a22731a6cf15958419a9a837dec1ff9a5395eee9ca99aa0db5f0ddada06d9b484e627e8c31a0444e6a64cfa854a0f783e748f68d80a5efba06069b95e3007d5e3bb25d747dc182c887edeade46fa1f2af5d49c9f429ed3774a0db2bd955de5a76983c319fbe51078cac6017881efc95848f0b6ae1988e7c7d0ca02efcef46816edd03f8bcefcefd783d277664b7abe8c5ddc33e78be5cd5e6167ba009887381ab79a3d44ae562b50dee905977ad5bef838b4a01a2e517fd8a3c7201a0b2c52c74f392745edf96414cda66a0526137892b5b560a1eca2551846a7c3866a0bdf88d8c1eb3b4f04b953cc617fbba4f2cd1f0c8bb5a56d0f8f279906d6c7d1e80f90211a0418dede3094af4ae5dd26bcb2b04b8b93a9629791d0177516ee6eac134913e0aa0d572368fac7f59ed1437eef4e05554240411abdc8d58c9e8a0e69c2ac30e744ca0980dcafe038e6ea00b8dba7f94c00ea7456ca08d33878c5c44eef7aba61e901ba0f11f693a54f600be4c64f629f1adb22e7de19ac4efde0911ad25cdc767f6dd1da0e1d250c658a7e98e9a84a00da24301347b6880623cc18034b64584efc06c8e49a0809bfed983cf0524e9ff9b4d7bebe105c663b86d4d95f22fe10345b8ac5e200da043f972b6cc2c44ee5f938199dc160b6ca45eda33fe6134fc8731ada7afb78c32a0d24fcc49261e0f659da6adf3ac6351d7c63d7036a5daf9008ccf8e4d79471bc4a0b3190bfedfddf6778deb8f6345be065957194059cf2040eb4261179c9d1ec9a8a07c3ab66333c79466723e5c6055af19a230d2458e9c1f26f69b08e75d9da8ee54a07cd533f3e86ebea9db73b369cd600c4447d92c2d39d798592b99ffafc31b1f5ea07d0534f7e52a7fd27cd414a0022aaa41c3d4f7ce2568fb96639547d3f25cd05aa0fc7b7dc4d0bd28c4212506c9e612800055f3583261e5caa3b4ec610cf9d7db59a0d52f467c81d11f310bb30a8528fd17431cde3eadffa00b86210470417bfb639ca0cce498a31fb06a8f747d686239b4f19dca239e40a378ce3b1f4006a2c7c868c8a013b6449f54a457c8c77708607c6069ba0ce972506f8b072dbe9d3fd931cd80bb80f8f1a096123db9192b6e29db6392ffc7aa5c5046aa0b12e40b688a6b7e1e88708c02d680a0791e7aec5e64bdfac85657e2f10178a82b807dd63027f89f8198a370311a8e31808080a064be38fc87a5208da02a2fa8d4ddc157d638e1ccb1b5805e9fdba41f151c4f6da0f40558ac68cb73d0693fa2db6bd93872fa83b2701fe026807404a55ebbf8faab80a0f7092e0007e47b1540b721877b90d3d98bf64de2948f04babab4192b0c5d450480a009157b7e154898d356b10d07e537d0aadbd30107069d303ad338367e499f7a14808080a0ffe5b78204edd7eead9d2bc2ad2cafec2450430e935ef6fd60935574f0e314c280f85180a00ccd6b1b6d7601266f939979a810d4c42b8cf6676f25778055a23bda076cfbeb8080808080808080a090b0f4c1f8207b6ec8f25d82ec3cd1309e040cae7813ace30a038494e98442bb808080808080e79d3638427703f0dbe7bb9bbf987a2551717b34e79f33b5b1008d1fa01db988875e336081790c4c",
  ],
  "0xf90256a06f14ee388c6004c9f591c05cc94509906ebcc57e6ce9d7e65c52aa7da6f530e7a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493479495222290dd7278aa3ddd389cc1e1d165cc4bafe5a07604903f485d83bda3b1333e28dec61ff3191fef0423ffce44abe02033b323d3a09c6967c2262b8e5aaf07f422806fa22eed9bd05898a71ef3435eb27e258ed240a061cf3a1b00a7ea8e1b8e4a921dbd9af3c73e9ec8646e9884b7936b74e011e05ab901005d61447fd94d1ba8d69022f0b7891c8486f9ae204a03b3b61bbbc905e371ecd613dfbe02ad85113252082314a8e78d016af918d9afd27030b5b7e890842a2f8058103e8c1640a87cd82c733d21e13afc3ce5e133ddd7fd3180a816dc8bfeeaa516555f3bf2545536b6605c1ea8276edf7d076e9346d88e37e24372bec69daa45caa8fe68c4c5edccefefbf60abaa9abee6106cf1dd25dc4fff490c7bf4b1f47993d733a25880a8170f165ed3bb283d69644fb677d0fd763a07218f66249961719ff37e762cf33f76036277f9c2d9e3d5a2a0b6b70cbfbd548a717143e29e3ef4a0f9b17f9f37bc546d06e5d23e02b3c64e2e542f026cf1d4391ccdf19400dc6d8084013d48a48401c9c3808401476c588466edbad78f6265617665726275696c642e6f7267a00b4078ca7a27f9b2448fa3f32e04a269353f80273e6dc95153458475a84238b98800000000000000008502d39a9e8ea00a7c969c5cab15361767d22966b8c0e507572acd096d3bc87af306be3ceb52138080a077f861b303ce5dd4bd241707d60a82406df608caa18ec241e33b5d5a2de94bc2",
  1,
]

let hashi: Contract, adapter: Contract, hashiProverTest: Contract, shoyuBashi: Contract, owner: SignerWithAddress

describe("HashiProver", () => {
  beforeEach(async () => {
    const Hashi = await ethers.getContractFactory("Hashi")
    const MockAdapter = await ethers.getContractFactory("MockAdapter")
    const HashiProverTest = await ethers.getContractFactory("HashiProverTest")
    const ShoyuBashi = await ethers.getContractFactory("ShoyuBashi")

    const signers = await ethers.getSigners()
    owner = signers[0]

    hashi = await Hashi.deploy()
    adapter = await MockAdapter.deploy()
    shoyuBashi = await ShoyuBashi.deploy(owner.address, hashi.address)
    hashiProverTest = await HashiProverTest.deploy(shoyuBashi.address)

    await shoyuBashi.enableAdapters(SOURCE_CHAIN_ID, [adapter.address], 1)
  })

  it("should't be able to get the value if block headers are not equal", async () => {
    const wrongAccountProof = [...ACCOUNT_PROOF]
    wrongAccountProof[2] = "0x0011"
    await expect(hashiProverTest.getValue(wrongAccountProof, STORAGE_PROOF)).to.be.revertedWithCustomError(
      hashiProverTest,
      "InvalidBlockHeader",
    )
  })

  it("should't be able to get the value if chain ids are not equal", async () => {
    const wrongAccountProof = [...ACCOUNT_PROOF]
    wrongAccountProof[3] = 2
    await expect(hashiProverTest.getValue(wrongAccountProof, STORAGE_PROOF)).to.be.revertedWithCustomError(
      hashiProverTest,
      "InvalidChainId",
    )
  })

  it("should't be able to get the value if the block is not available", async () => {
    await expect(hashiProverTest.getValue(ACCOUNT_PROOF, STORAGE_PROOF)).to.be.revertedWithCustomError(
      shoyuBashi,
      "ThresholdNotMet",
    )
  })

  it("should't be able to get the value if the block is not equal to the one reported by hashi", async () => {
    const wrongBlockHeaderHash = "0xafd0481857f5745a4511c51695d753c56380f8a7406ae63dad368e4abdb3ec46"
    await adapter.setHashes(SOURCE_CHAIN_ID, [BLOCK_NUMBER], [wrongBlockHeaderHash])
    await expect(hashiProverTest.getValue(ACCOUNT_PROOF, STORAGE_PROOF)).to.be.revertedWithCustomError(
      hashiProverTest,
      "InvalidBlockHeader",
    )
  })

  it("should't be able to get the value if the storage proof storage_hash is not equal to the one exctracted using the account proof", async () => {
    const wrongStorageProof = [...STORAGE_PROOF]
    wrongStorageProof[0] = "0x9d5704aa434de9751d3bfcf9e720a8eb0464ed2b467bd27af86c0415ac15fa10"
    await adapter.setHashes(SOURCE_CHAIN_ID, [BLOCK_NUMBER], [BLOCK_HEADER_HASH])
    await expect(hashiProverTest.getValue(ACCOUNT_PROOF, wrongStorageProof)).to.be.revertedWithCustomError(
      hashiProverTest,
      "InvalidStorageHash",
    )
  })

  it("should be able to get the value", async () => {
    await adapter.setHashes(SOURCE_CHAIN_ID, [BLOCK_NUMBER], [BLOCK_HEADER_HASH])
    expect(await hashiProverTest.getValue(ACCOUNT_PROOF, STORAGE_PROOF)).to.be.deep.eq([VALUE])
  })
})
